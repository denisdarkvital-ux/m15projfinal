
CREATE DATABASE shopiVitali;
USE shopiVitali;

CREATE TABLE Cliente (
    id_cliente INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    telefone VARCHAR(20),
    morada VARCHAR(200)
);

CREATE TABLE Produto (
    id_produto INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    preco DECIMAL(10,2) NOT NULL CHECK (preco >= 0),
    stock INT DEFAULT 0 CHECK (stock >= 0)
);

CREATE TABLE Encomenda (
    id_encomenda INT AUTO_INCREMENT PRIMARY KEY,
    id_cliente INT NOT NULL,
    id_transportadora INT,
    data_encomenda DATE NOT NULL DEFAULT (CURRENT_DATE),
    estado ENUM('Pendente', 'Processando', 'Enviado', 'Entregue', 'Cancelado') DEFAULT 'Pendente',
    FOREIGN KEY (id_cliente) REFERENCES Cliente(id_cliente)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE Pagamento (
    id_pagamento INT AUTO_INCREMENT PRIMARY KEY,
    id_encomenda INT NOT NULL UNIQUE,
    tipo_pagamento ENUM('Cartao', 'PayPal', 'MBWay', 'Transferencia') NOT NULL,
    valor DECIMAL(10,2) NOT NULL CHECK (valor > 0),
    data_pagamento DATE NOT NULL,
    FOREIGN KEY (id_encomenda) REFERENCES Encomenda(id_encomenda)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE Transportadora (
    id_transportadora INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    contacto VARCHAR(100)
);

CREATE TABLE Encomenda_Produto (
    id_encomenda INT NOT NULL,
    id_produto INT NOT NULL,
    quantidade INT NOT NULL CHECK (quantidade > 0),
    PRIMARY KEY (id_encomenda, id_produto),
    FOREIGN KEY (id_encomenda) REFERENCES Encomenda(id_encomenda)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (id_produto) REFERENCES Produto(id_produto)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

	INSERT INTO Cliente (nome, email, telefone, morada) VALUES
	('Windoh', 'windoh@gmail.com', '912345678', 'Rua das Flores, Lisboa'),
	('Joana', 'joana@gmail.com', '934567890', 'Av. Central, Porto'),
	('Luis Araujo', 'luis@gmail.com', '967890123', 'Rua do Sol, Braga'),
	('Ana Almeida', 'aninha@gmail.com', '911223344', 'Travessa Nova, Coimbra'),
	('Romeu', 'romeu@email.com', '939998877', 'Rua das Amoreiras, Faro');

INSERT INTO Produto (nome, preco, stock) VALUES
('Mapa Mágico', 59.99, 20),
('Tartaruga ninja', 24.50, 35),
('Monitor 24"', 149.90, 10),
('Oculos LV', 79.99, 15),
('Cadeira de Escritório', 199.00, 8);

INSERT INTO Transportadora (nome, contacto) VALUES
('CTT Expresso', 'ctt@ctt.pt'),
('DHL Portugal', 'contact@dhl.pt'),
('SEUR', 'info@seur.pt'),
('MRW', 'apoio@mrw.pt'),
('FedEx', 'suporte@fedex.pt');

INSERT INTO Encomenda (id_cliente, id_transportadora, data_encomenda, estado) VALUES
(1, 1, '2025-10-01', 'Pendente'),
(2, 2, '2025-10-02', 'Processando'),
(3, 3, '2025-10-03', 'Enviado'),
(4, 4, '2025-10-04', 'Entregue'),
(5, 5, '2025-10-05', 'Cancelado');

INSERT INTO Encomenda_Produto (id_encomenda, id_produto, quantidade) VALUES
(1, 1, 1),
(2, 2, 2),
(3, 3, 1),
(4, 4, 1),
(5, 5, 1);

SELECT * FROM Encomenda;

SELECT * 
FROM Encomenda
WHERE estado = 'Enviado';

SELECT 
    c.nome AS Cliente,
    e.id_encomenda AS Encomenda,
    e.data_encomenda AS Data,
    e.estado AS Estado
FROM Encomenda e
JOIN Cliente c ON e.id_cliente = c.id_cliente;

UPDATE Encomenda
SET estado = 'Entregue'
WHERE id_encomenda = 3;

DELETE FROM Cliente
WHERE id_cliente IN (4, 5);

